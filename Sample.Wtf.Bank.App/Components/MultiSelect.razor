@using System.Linq

<div class="relative w-full @Class">
    <!-- Dropdown Toggle Button -->
    <button @onclick="ToggleDropdown" class="block w-full bg-gray-600 rounded-md text-white focus:outline-none focus:border-blue-500">
        @if (SelectedOptions.Any())
        {
        <span>@string.Join(", ", SelectedOptions)</span>
        }
        else
        {
        <span class="text-gray-400">@Text</span>
        }
        <svg class="inline-block w-5 h-5 ml-2 -mr-1 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 011.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
    </button>

    <!-- Dropdown Menu -->
    @if (IsDropdownOpen)
    {
    <div class="absolute left-0 right-0 z-10 mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto" style="width: 100%;">

        <!-- Search Bar -->
        <input
            type="text"
            placeholder="Search..."
            @bind="searchTerm"
            class="w-full p-2 border-b border-gray-300 focus:outline-none"
        />

        <!-- Options List -->
        @foreach (var option in FilteredOptions)
        {
        <div class="flex items-center p-2 cursor-pointer hover:bg-blue-100"
             @onclick="() => ToggleSelection(option)">
            <input type="checkbox" checked="@SelectedOptions.Contains(option)" class="mr-2" />
            <span>@option</span>
        </div>
        }
    </div>
    }
</div>

@code {
[Parameter] public string Class { get; set; } = "";
[Parameter] public string Text { get; set; } = "...";
private bool IsDropdownOpen = false;
private string searchTerm = "";

private List<string> options = new() { "Apple", "Banana", "Orange", "Grape", "Strawberry", "Blueberry", "Mango", "Pineapple" };
private List<string> SelectedOptions { get; set; } = new();

private IEnumerable<string> FilteredOptions =>
options.Where(option => option.Contains(searchTerm, StringComparison.OrdinalIgnoreCase));

private void ToggleDropdown() => IsDropdownOpen = !IsDropdownOpen;

private void ToggleSelection(string option)
{
if (SelectedOptions.Contains(option))
{
SelectedOptions.Remove(option);
}
else
{
SelectedOptions.Add(option);
}
}
}